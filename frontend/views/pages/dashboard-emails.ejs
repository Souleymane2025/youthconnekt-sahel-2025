<%- include('../layouts/dashboard', { 
  content: `
    <div class="dashboard-header">
      <div class="d-flex justify-content-between align-items-center">
        <h2><i class="fas fa-envelope me-2"></i>Gestion des Emails</h2>
        <div>
          <button class="btn btn-outline-primary me-2" onclick="refreshEmails()">
            <i class="fas fa-sync-alt me-1"></i>Actualiser
          </button>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#composeEmailModal">
            <i class="fas fa-plus me-2"></i>Nouveau Email
          </button>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card stats-card bg-primary text-white">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h5 class="card-title">Total Envoyés</h5>
                <h3 class="mb-0" id="totalSent">350</h3>
              </div>
              <i class="fas fa-paper-plane fa-2x opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stats-card bg-success text-white">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h5 class="card-title">Livrés</h5>
                <h3 class="mb-0" id="totalDelivered">348</h3>
              </div>
              <i class="fas fa-check-circle fa-2x opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stats-card bg-info text-white">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h5 class="card-title">Ouverts</h5>
                <h3 class="mb-0" id="totalOpened">261</h3>
              </div>
              <i class="fas fa-envelope-open fa-2x opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stats-card bg-warning text-white">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h5 class="card-title">Échecs</h5>
                <h3 class="mb-0" id="totalFailed">2</h3>
              </div>
              <i class="fas fa-exclamation-triangle fa-2x opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Email Campaigns -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Campagnes Email</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover" id="emailsTable">
            <thead>
              <tr>
                <th>Campagne</th>
                <th>Destinataires</th>
                <th>Statut</th>
                <th>Date d'envoi</th>
                <th>Taux d'ouverture</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="emailsTableBody">
              <tr>
                <td>Bienvenue YouthConnect 2025</td>
                <td>150</td>
                <td><span class="badge bg-success">Envoyé</span></td>
                <td>15/01/2025 10:00</td>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="progress flex-grow-1 me-2" style="height: 20px;">
                      <div class="progress-bar" role="progressbar" style="width: 75%">75%</div>
                    </div>
                  </div>
                </td>
                <td>
                  <button class="btn btn-sm btn-outline-primary me-1" onclick="viewEmailDetails(1)">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-success me-1" onclick="duplicateEmail(1)">
                    <i class="fas fa-copy"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteEmail(1)">
                    <i class="fas fa-trash"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td>Rappel Inscription</td>
                <td>200</td>
                <td><span class="badge bg-warning">Programmé</span></td>
                <td>20/01/2025 09:00</td>
                <td>
                  <div class="d-flex align-items-center">
                    <span class="text-muted">En attente</span>
                  </div>
                </td>
                <td>
                  <button class="btn btn-sm btn-outline-primary me-1" onclick="viewEmailDetails(2)">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-success me-1" onclick="duplicateEmail(2)">
                    <i class="fas fa-copy"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteEmail(2)">
                    <i class="fas fa-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Email Templates -->
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Modèles d'Email</h5>
        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#templateModal">
          <i class="fas fa-plus me-1"></i>Nouveau Modèle
        </button>
      </div>
      <div class="card-body">
        <div class="row" id="templatesContainer">
          <div class="col-md-6 col-lg-4 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <h6 class="card-title">Bienvenue</h6>
                <p class="card-text text-muted small">Email de bienvenue pour nouveaux participants</p>
                <div class="mt-auto">
                  <button class="btn btn-sm btn-outline-primary me-1" onclick="previewTemplate(1)">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-success me-1" onclick="useTemplate(1)">
                    <i class="fas fa-plus"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-warning me-1" onclick="editTemplate(1)">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteTemplate(1)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-lg-4 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <h6 class="card-title">Confirmation</h6>
                <p class="card-text text-muted small">Confirmation d'inscription</p>
                <div class="mt-auto">
                  <button class="btn btn-sm btn-outline-primary me-1" onclick="previewTemplate(2)">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-success me-1" onclick="useTemplate(2)">
                    <i class="fas fa-plus"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-warning me-1" onclick="editTemplate(2)">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteTemplate(2)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Composer Email -->
    <div class="modal fade" id="composeEmailModal" tabindex="-1">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Composer un Email</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="composeEmailForm">
              <div class="row">
                <div class="col-md-6">
                  <label class="form-label">Destinataires</label>
                  <select class="form-select" name="recipients" required>
                    <option value="">Sélectionner les destinataires</option>
                    <option value="all">Tous les participants</option>
                    <option value="confirmed">Participants confirmés</option>
                    <option value="pending">Participants en attente</option>
                    <option value="speakers">Conférenciers</option>
                    <option value="sponsors">Sponsors</option>
                    <option value="custom">Liste personnalisée</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Modèle</label>
                  <select class="form-select" name="template" onchange="loadTemplate()">
                    <option value="">Partir de zéro</option>
                    <option value="welcome">Bienvenue</option>
                    <option value="confirmation">Confirmation</option>
                    <option value="reminder">Rappel</option>
                    <option value="newsletter">Newsletter</option>
                  </select>
                </div>
              </div>
              
              <div class="mt-3">
                <label class="form-label">Objet</label>
                <input type="text" class="form-control" name="subject" placeholder="Objet de l'email" required>
              </div>
              
              <div class="mt-3">
                <label class="form-label">Corps de l'email</label>
                <textarea class="form-control" name="emailContent" rows="10" placeholder="Contenu de votre email..."></textarea>
              </div>
              
              <div class="row mt-3">
                <div class="col-md-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="sendNow" id="sendNow" checked>
                    <label class="form-check-label" for="sendNow">
                      Envoyer immédiatement
                    </label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div id="scheduleSection" style="display: none;">
                    <label class="form-label">Programmer pour</label>
                    <input type="datetime-local" class="form-control" name="scheduledTime">
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button type="button" class="btn btn-outline-primary" onclick="previewEmail()">
              <i class="fas fa-eye me-1"></i>Aperçu
            </button>
            <button type="button" class="btn btn-primary" onclick="sendEmail()">
              <i class="fas fa-paper-plane me-1"></i>Envoyer
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Modèle -->
    <div class="modal fade" id="templateModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Créer un Modèle</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="templateForm">
              <div class="mb-3">
                <label class="form-label">Nom du modèle</label>
                <input type="text" class="form-control" name="templateName" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Description</label>
                <textarea class="form-control" name="templateDescription" rows="2"></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Contenu HTML</label>
                <textarea class="form-control" name="templateContent" rows="10" placeholder="<html>...</html>"></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button type="button" class="btn btn-primary" onclick="saveTemplate()">
              <i class="fas fa-save me-1"></i>Sauvegarder
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('sendNow').addEventListener('change', function() {
        document.getElementById('scheduleSection').style.display = this.checked ? 'none' : 'block';
      });
    });

    function refreshEmails() {
      alert('Données actualisées.');
    }

    function loadTemplate() {
      const templateSelect = document.querySelector('select[name="template"]');
      const selectedValue = templateSelect.value;
      
      if (selectedValue) {
        document.querySelector('input[name="subject"]').value = selectedValue.charAt(0).toUpperCase() + selectedValue.slice(1);
        alert('Modèle chargé: ' + selectedValue);
      }
    }

    function previewEmail() {
      alert('Aperçu de l\'email... Fonctionnalité à venir.');
    }

    function sendEmail() {
      const form = document.getElementById('composeEmailForm');
      const formData = new FormData(form);
      
      if (!formData.get('recipients') || !formData.get('subject')) {
        alert('Veuillez remplir tous les champs obligatoires.');
        return;
      }
      
      const modal = bootstrap.Modal.getInstance(document.getElementById('composeEmailModal'));
      modal.hide();
      form.reset();
      
      alert('Email envoyé avec succès !');
    }

    function saveTemplate() {
      const form = document.getElementById('templateForm');
      const formData = new FormData(form);
      
      if (!formData.get('templateName')) {
        alert('Veuillez saisir un nom pour le modèle.');
        return;
      }
      
      const modal = bootstrap.Modal.getInstance(document.getElementById('templateModal'));
      modal.hide();
      form.reset();
      
      alert('Modèle sauvegardé avec succès !');
    }

    function viewEmailDetails(emailId) {
      alert('Détails de la campagne #' + emailId + '... Fonctionnalité à venir.');
    }

    function duplicateEmail(emailId) {
      alert('Email #' + emailId + ' dupliqué avec succès !');
    }

    function deleteEmail(emailId) {
      if (confirm('Supprimer cette campagne email ?')) {
        alert('Campagne #' + emailId + ' supprimée avec succès !');
      }
    }

    function previewTemplate(templateId) {
      alert('Aperçu du modèle #' + templateId + '... Fonctionnalité à venir.');
    }

    function useTemplate(templateId) {
      const modal = new bootstrap.Modal(document.getElementById('composeEmailModal'));
      modal.show();
      alert('Modèle #' + templateId + ' sélectionné pour composition.');
    }

    function editTemplate(templateId) {
      const modal = new bootstrap.Modal(document.getElementById('templateModal'));
      modal.show();
      alert('Édition du modèle #' + templateId + '...');
    }

    function deleteTemplate(templateId) {
      if (confirm('Supprimer ce modèle ?')) {
        alert('Modèle #' + templateId + ' supprimé avec succès !');
      }
    }
    </script>
  `,
  title: 'Gestion des Emails'
}) %>
