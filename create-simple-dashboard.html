<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Participants - YouthConnekt Sahel 2025</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .card { border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .table th { background-color: #28a745; color: white; }
        .loading { text-align: center; padding: 50px; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="text-success"><i class="fas fa-users me-2"></i>Participants Dashboard</h2>
                    <button class="btn btn-success" onclick="loadParticipants()">
                        <i class="fas fa-sync-alt me-1"></i>Actualiser
                    </button>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div id="loading" class="loading">
                            <i class="fas fa-spinner fa-spin fa-2x text-success"></i>
                            <p class="mt-2">Chargement des participants...</p>
                        </div>

                        <div id="error" class="alert alert-danger" style="display: none;">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <span id="error-message"></span>
                        </div>

                        <div id="participants-container" style="display: none;">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Nom</th>
                                            <th>Email</th>
                                            <th>Pays</th>
                                            <th>Ville</th>
                                            <th>Type</th>
                                            <th>Statut</th>
                                            <th>Organisation</th>
                                        </tr>
                                    </thead>
                                    <tbody id="participants-table">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="no-data" class="text-center py-5" style="display: none;">
                            <i class="fas fa-database fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">Aucun participant trouv√©</h5>
                            <p class="text-muted">V√©rifiez que le backend Laravel est d√©marr√©</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function loadParticipants() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const participantsContainer = document.getElementById('participants-container');
            const noData = document.getElementById('no-data');
            const tableBody = document.getElementById('participants-table');

            // Afficher le loading
            loading.style.display = 'block';
            error.style.display = 'none';
            participantsContainer.style.display = 'none';
            noData.style.display = 'none';

            try {
                console.log('üîÑ Tentative de r√©cup√©ration des participants...');
                
                const response = await fetch('http://localhost:8000/api/participants', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                console.log('üìä R√©ponse re√ßue:', response.status);

                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }

                const data = await response.json();
                console.log('üìã Donn√©es re√ßues:', data);

                loading.style.display = 'none';

                if (data && data.data && Array.isArray(data.data) && data.data.length > 0) {
                    // Afficher les participants
                    tableBody.innerHTML = '';
                    
                    data.data.forEach((participant, index) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${participant.id || index + 1}</td>
                            <td>${participant.first_name || ''} ${participant.last_name || ''}</td>
                            <td>${participant.email || 'N/A'}</td>
                            <td>${participant.country || 'N/A'}</td>
                            <td>${participant.city || 'N/A'}</td>
                            <td>
                                <span class="badge ${participant.type === 'international' ? 'bg-info' : 'bg-primary'}">
                                    ${participant.type || 'N/A'}
                                </span>
                            </td>
                            <td>
                                <span class="badge ${participant.status === 'confirmed' ? 'bg-success' : 'bg-warning'}">
                                    ${participant.status || 'N/A'}
                                </span>
                            </td>
                            <td>${participant.organization || 'N/A'}</td>
                        `;
                        tableBody.appendChild(row);
                    });

                    participantsContainer.style.display = 'block';
                    console.log(`‚úÖ ${data.data.length} participants affich√©s`);
                } else {
                    noData.style.display = 'block';
                    console.log('‚ö†Ô∏è Aucun participant trouv√©');
                }

            } catch (err) {
                console.error('‚ùå Erreur:', err);
                loading.style.display = 'none';
                error.style.display = 'block';
                document.getElementById('error-message').textContent = 
                    `Impossible de charger les participants: ${err.message}. V√©rifiez que le backend Laravel est d√©marr√© sur http://localhost:8000`;
            }
        }

        // Charger les participants au d√©marrage
        document.addEventListener('DOMContentLoaded', function() {
            loadParticipants();
        });

        // Actualiser toutes les 30 secondes
        setInterval(loadParticipants, 30000);
    </script>
</body>
</html>








